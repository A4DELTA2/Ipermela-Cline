<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ipermela Store - Ordini</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Schermata di Login (visibile prima dell'autenticazione) -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1>üçé Ipermela Store</h1>
                <p>Sistema Gestione Ordini</p>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input 
                        type="email" 
                        id="login-email" 
                        placeholder="tuaemail@ipermela.it" 
                        required 
                        autocomplete="email"
                    />
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input 
                        type="password" 
                        id="login-password" 
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                        required 
                        autocomplete="current-password"
                    />
                </div>
                <button type="submit" class="btn-login">
                    Accedi
                </button>
            </form>
            <div class="login-footer">
                <p>üîí Accesso sicuro con Supabase Auth</p>
            </div>
        </div>
    </div>

    <!-- App Principale (visibile dopo l'autenticazione) -->
    <div id="app-container" class="container" style="display: none;">
        <header>
            <div class="header-left">
                <h1>Ipermela Store - Ordini</h1>
            </div>
            <div class="header-right">
                <span class="user-info">
                    üë§ <span id="user-email">utente@ipermela.it</span>
                </span>
                <button id="logout-btn" class="logout-btn" title="Logout">
                    Esci
                </button>
            </div>
            <div class="header-actions desktop-menu">
                <button id="price-management-btn" class="header-btn" title="Gestione Prezzi">
                    <span class="btn-icon">üè∑Ô∏è</span>
                </button>
                <button id="quick-add-btn" class="header-btn" title="Aggiungi prodotto">
                    <span class="btn-icon">‚ûï</span>
                </button>
                <button id="quick-cart-btn" class="header-btn" title="Vai al carrello">
                    <span class="btn-icon">üõí</span>
                    <span id="cart-count" class="cart-badge">0</span>
                </button>
            </div>
            <div class="mobile-menu">
                <button id="mobile-menu-btn" class="header-btn mobile-menu-toggle" title="Menu">
                    <span class="btn-icon">‚ò∞</span>
                </button>
                <div id="mobile-dropdown" class="mobile-dropdown">
                    <div class="mobile-user-info">
                        <span>üë§ <span id="user-email-mobile">utente@ipermela.it</span></span>
                    </div>
                    <button class="mobile-menu-item" data-action="price-management">
                        <span class="mobile-menu-icon">üè∑Ô∏è</span>
                        <span class="mobile-menu-text">Gestione Prezzi</span>
                    </button>
                    <button class="mobile-menu-item" data-action="quick-add">
                        <span class="mobile-menu-icon">‚ûï</span>
                        <span class="mobile-menu-text">Aggiungi Prodotto</span>
                    </button>
                    <button class="mobile-menu-item" data-action="quick-cart">
                        <span class="mobile-menu-icon">üõí</span>
                        <span class="mobile-menu-text">Vai al Carrello</span>
                        <span id="cart-count-mobile" class="cart-badge-mobile">0</span>
                    </button>
                    <button id="mobile-logout-btn" class="mobile-menu-item logout-mobile">
                        <span class="mobile-menu-icon">üö™</span>
                        <span class="mobile-menu-text">Esci</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Sezione Catalogo -->
            <section class="catalog-section">
                <h2>Catalogo Prodotti</h2>
                
                <!-- Barra di Ricerca -->
                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="üîç Cerca prodotti..." />
                </div>
                
                <!-- Filtri per Categoria -->
                <div class="category-filters">
                    <button class="category-btn active" data-category="all">Tutti</button>
                    <button class="category-btn" data-category="iphone">iPhone</button>
                    <button class="category-btn" data-category="mac">Mac</button>
                    <button class="category-btn" data-category="ipad">iPad</button>
                    <button class="category-btn" data-category="accessori">Accessori</button>
                </div>
                
                <!-- Sottocategorie Mac (nascoste di default) -->
                <div id="mac-subcategories" class="mac-subcategories" style="display: none;">
                    <button class="subcategory-btn active" data-subcategory="all">Tutti i Mac</button>
                    <button class="subcategory-btn" data-subcategory="macbook-air">MacBook Air</button>
                    <button class="subcategory-btn" data-subcategory="macbook-pro">MacBook Pro</button>
                    <button class="subcategory-btn" data-subcategory="imac">iMac</button>
                    <button class="subcategory-btn" data-subcategory="mac-mini">Mac mini</button>
                    <button class="subcategory-btn" data-subcategory="mac-studio">Mac Studio</button>
                </div>

                <!-- Griglia Prodotti -->
                <div id="products-grid" class="products-grid"></div>

                <!-- Aggiungi Accessorio Personalizzato -->
                <div class="custom-accessory">
                    <h3>‚ûï Aggiungi Accessorio Personalizzato</h3>
                    <div class="custom-form">
                        <input type="text" id="custom-name" placeholder="Nome accessorio" />
                        <input type="number" id="custom-price" placeholder="Prezzo (‚Ç¨)" min="0" step="0.01" />
                        <button id="add-custom-btn" class="btn-primary">Aggiungi al Catalogo</button>
                    </div>
                </div>
            </section>

            <!-- Sezione Carrello/Ordine -->
            <section class="cart-section">
                <h2>Ordine Corrente</h2>
                
                <div id="cart-items" class="cart-items"></div>
                
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Subtotale:</span>
                        <span id="subtotal">‚Ç¨0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>IVA (22%):</span>
                        <span id="tax">‚Ç¨0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Totale:</span>
                        <span id="total">‚Ç¨0.00</span>
                    </div>
                </div>

                <div class="cart-actions">
                    <button id="clear-cart-btn" class="btn-secondary">Svuota Carrello</button>
                    <button id="save-order-btn" class="btn-primary">Salva Ordine</button>
                </div>
            </section>
        </div>

        <!-- Sezione Ordini Salvati -->
        <section class="orders-section">
            <h2>Ordini Salvati</h2>
            <div id="saved-orders" class="saved-orders"></div>
        </section>
    </div>

    <!-- Modal per Salvataggio Ordine -->
    <div id="order-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Completa Ordine</h2>
            <div class="modal-form">
                <input type="text" id="customer-name" placeholder="Nome Cliente" required />
                <input type="email" id="customer-email" placeholder="Email Cliente" />
                <input type="tel" id="customer-phone" placeholder="Telefono" />
                <textarea id="order-notes" placeholder="Note ordine (opzionale)"></textarea>
                <button id="confirm-order-btn" class="btn-primary">Conferma Ordine</button>
            </div>
        </div>
    </div>

    <!-- Sezione Gestione Prezzi (nascosta di default) -->
    <div id="price-management-section" class="price-management-section" style="display: none;">
        <div class="price-management-container">
            <div class="price-management-header">
                <h2>üè∑Ô∏è Gestione Prezzi</h2>
                <button id="close-price-management" class="btn-secondary">‚úï Chiudi</button>
            </div>

            <div class="price-management-controls">
                <div class="search-bar">
                    <input type="text" id="price-search-input" placeholder="üîç Cerca prodotto..." />
                </div>
                <div class="category-filters">
                    <button class="price-category-btn active" data-category="all">Tutti</button>
                    <button class="price-category-btn" data-category="iphone">iPhone</button>
                    <button class="price-category-btn" data-category="mac">Mac</button>
                    <button class="price-category-btn" data-category="ipad">iPad</button>
                    <button class="price-category-btn" data-category="accessori">Accessori</button>
                </div>
            </div>

            <div class="price-table-container">
                <table id="price-table" class="price-table">
                    <thead>
                        <tr>
                            <th>Icona</th>
                            <th>Prodotto</th>
                            <th>Prezzo Originale</th>
                            <th>Prezzo Attuale</th>
                            <th>Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="price-table-body">
                        <!-- Popolato dinamicamente -->
                    </tbody>
                </table>
            </div>

            <div class="price-management-actions">
                <button id="save-all-prices-btn" class="btn-primary">üíæ Salva Tutte le Modifiche</button>
                <button id="reset-all-prices-btn" class="btn-secondary">‚Ü©Ô∏è Ripristina Tutti gli Originali</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
